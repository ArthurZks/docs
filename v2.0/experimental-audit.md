---
title: EXPERIMENTAL_AUDIT
summary: Use the `EXPERIMENTAL_AUDIT` setting to enable SQL audit logs on a per-table basis.
toc: false
---

The `EXPERIMENTAL_AUDIT` [statement](sql-statements.html) is part of `ALTER TABLE` and is used to enable SQL audit logs on a per-table basis.

You may want to enable audit logs for a number of reasons, including:

- You want to see what SQL queries are being run by which users

- You want to see what queries were run against a table containing personally identifiable information (PII)

- You are troubleshooting (or just optimizing) your CockroachDB setup, and you want to see which user queries correlate with episodes of higher or lower system load, response latency, etc.

The audit logs contain detailed information about queries being executed against your system, including:

- Full text of the query (which may include personally identifiable information (PII))
- Date/Time
- Client address
- Application name

For a detailed description of exactly what is logged, see the [Log File Format](#log-file-format) section below.

<div id="toc"></div>

## Synopsis

*FIXME: generate sql diagram and link from here*

## Required Privileges

*FIXME: verify this*

Only the `root` user can enable audit logs on a table.

## Parameters

*FIXME: Do you need to update this once SQL diagram generation is done? Not 100% sure how we determine the parameter lists.*

| Parameter    | Description                                              |
|--------------+----------------------------------------------------------|
| `READ`       | Log all table reads to the audit log file.               |
| `WRITE`      | Log all table writes to the audit log file.              |
| `table_name` | The name of the table you want to create audit logs for. |

{{site.data.alerts.callout_info}}
As of version 2.0, this command logs all reads and writes.  Therefore, both the `READ` and  `WRITE` parameters are required (as shown in the [examples](#examples) below).

In a future release, this should change to allow logging only reads, only writes, or both.
{{site.data.alerts.end}}

## Examples

Let's say you have a  `customers` table that contains personally identifiable information (PII), like the one from the [`ADD CONSTRAINT` foreign key example](add-constraint.html#add-the-foreign-key-constraint-with-cascade).  To turn on audit logs for that table, run the following command:

~~~ sql
ALTER TABLE customers EXPERIMENTAL_AUDIT SET READ WRITE;
~~~

Now, every access of customer data is added to the SQL audit log with a line that looks like the following:

~~~
I180211 07:30:48.832004 317 sql/exec_log.go:90  [client=127.0.0.1:62503,user=root,n1] 13 exec "cockroach" {"customers"[53]:READ} "SELECT * FROM customers" {} 123.45 12 OK
I180211 07:30:48.832004 317 sql/exec_log.go:90  [client=127.0.0.1:62503,user=root,n1] 13 exec "cockroach" {"customers"[53]:READ} "SELECT nonexistent FROM customers" {} 0.123 12 ERROR
~~~

{{site.data.alerts.callout_success}}
Note: For a detailed description of the log file format, see [Log File Format](#log-file-format) below.
{{site.data.alerts.end}}

To turn off logging, issue the following command:

~~~ sql
ALTER TABLE customers EXPERIMENTAL_AUDIT SET OFF;
~~~

Note that you can enable logging on multiple tables at once as follows:

~~~ sql
ALTER TABLE (customers, orders) EXPERIMENTAL_AUDIT SET READ WRITE;
~~~

<a name="log-file-format"></a>

## Audit Log File Format

{% include log-file-format.md %}

## Audit Log File Storage Location

By default, SQL audit logs are stored in the same directory as the other logs generated by CockroachDB.

To store the audit log files in a specific directory, pass the `--sql-audit-dir` flag to [`cockroach start`](start-a-node.html#logging).

## See Also

- [`ALTER TABLE`](alter-table.html)
- [Understand Debug, Error, and Audit Logs](debug-and-error-logs.html)
- [`cockroach start` logging flags](start-a-node.html#logging)
